<% if (isAdmin) { %>
  <%- include('navigation-admin.ejs') %>
<% } else { %>
<link rel="stylesheet" href="/css/navigation.css">
<link href="https://fonts.googleapis.com/css2?family=Pacifico:wght@400&display=swap" rel="stylesheet">

<nav class="nav-container sticky top-0 z-50">
    <div class="nav-content">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="/" class="nav-brand">
                        <i class="ri-store-line"></i>
                        <span class="brand-logo-nav">Shoe Store</span>
                    </a>
                </div>
            
                <!-- Desktop Navigation -->
                <div class="nav-links hidden md:flex">
                    <a href="/" class="nav-link <%= path === '/' ? 'active' : '' %>">
                        <i class="ri-home-line"></i> Trang chủ
                    </a>
                    <a href="/products" class="nav-link <%= path === '/products' ? 'active' : '' %>">
                        <i class="ri-store-line"></i> Sản phẩm
                    </a>
                    <a href="/brands" class="nav-link <%= path === '/brands' ? 'active' : '' %>">
                        <i class="ri-award-line"></i> Thương hiệu
                    </a>
                    <a href="/about" class="nav-link <%= path === '/about' ? 'active' : '' %>">
                        <i class="ri-information-line"></i> Giới thiệu
                    </a>
                    <a href="/contact" class="nav-link <%= path === '/contact' ? 'active' : '' %>">
                        <i class="ri-contacts-line"></i> Liên hệ
                    </a>
                    <!-- Search Form -->
                    <form action="/search" method="GET" class="nav-search">
                        <input type="text" name="q" placeholder="Tìm kiếm..." class="search-input">
                        <button type="submit" class="search-button">
                            <i class="ri-search-line"></i>
                        </button>
                    </form>
                </div>

                <!-- User Actions -->
                <div class="nav-actions">
                    <!-- Cart - hiển thị cho tất cả người dùng -->
                    <a href="/cart" class="action-button <%= path === '/cart' ? 'active' : '' %>">
                        <i class="ri-shopping-cart-line"></i>
                        <% if (typeof cartCount !== 'undefined' && cartCount > 0) { %>
                            <span class="cart-badge"><%= cartCount %></span>
                        <% } %>
                    </a>
                
                    <% if (isAuthenticated) { %>
                        <!-- Orders - Ẩn vì đã có trong dropdown -->
                        <!-- <a href="/orders" class="action-button <%= path === '/orders' ? 'active' : '' %>">
                            <i class="ri-box-line"></i>
                        </a> -->

                        <!-- Unified User/Admin dropdown menu -->
                        <div class="user-dropdown">
                            <button class="dropdown-button">
                                <i class="ri-user-line"></i>
                                <span class="hidden md:block"><%= user ? user.name : 'Người dùng' %></span>
                                <i class="ri-arrow-down-s-line"></i>
                            </button>
                            <div class="dropdown-menu">
                                <div class="dropdown-header">
                                    <i class="ri-user-circle-line"></i> <%= user ? user.email : '' %>
                                </div>
                                <% if (isAdmin === true) { %>
                                    <a href="/admin/add-product" class="dropdown-item <%= path === '/admin/add-product' ? 'active' : '' %>">
                                        <i class="ri-add-circle-line"></i> Thêm sản phẩm
                                    </a>
                                    <a href="/admin/products" class="dropdown-item <%= path === '/admin/products' ? 'active' : '' %>">
                                        <i class="ri-list-check"></i> Quản lý sản phẩm
                                    </a>
                                    <a href="/admin/orders" class="dropdown-item <%= path === '/admin/orders' ? 'active' : '' %>">
                                        <i class="ri-shopping-bag-line"></i> Quản lý đơn hàng
                                    </a>
                                    <div class="dropdown-divider"></div>
                                <% } %>
                                <a href="/profile" class="dropdown-item <%= path === '/profile' ? 'active' : '' %>">
                                    <i class="ri-user-settings-line"></i> Thông tin cá nhân
                                </a>
                                <% if (!isAdmin) { %>
                                <a href="/favorites" class="dropdown-item <%= path === '/favorites' ? 'active' : '' %>">
                                    <i class="ri-heart-line"></i> Sản phẩm yêu thích
                                </a>
                                <a href="/orders" class="dropdown-item <%= path === '/orders' ? 'active' : '' %>">
                                    <i class="ri-shopping-bag-3-line"></i> Đơn hàng của tôi
                                </a>
                                <% } %>
                                <a href="/profile/change-password" class="dropdown-item <%= path === '/profile/change-password' ? 'active' : '' %>">
                                    <i class="ri-lock-password-line"></i> Đổi mật khẩu
                                </a>
                                <div class="dropdown-divider"></div>
                                <form action="/logout" method="POST" class="block">
                                    <button type="submit" class="logout-button">
                                        <i class="ri-logout-box-line"></i> Đăng xuất
                                    </button>
                                </form>
                            </div>
                        </div>
                    <% } else { %>
                        <a href="/login" class="login-btn-nav <%= path === '/login' ? 'active' : '' %>">
                            <i class="ri-login-box-line"></i> Đăng nhập
                        </a>
                    <% } %>
                
                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn" id="mobile-menu-btn">
                        <i class="ri-menu-line"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div class="mobile-nav" id="mobile-menu">
                <a href="/" class="mobile-nav-item <%= path === '/' ? 'active' : '' %>">
                    <i class="ri-home-line"></i> Trang chủ
                </a>
                <a href="/products" class="mobile-nav-item <%= path === '/products' ? 'active' : '' %>">
                    <i class="ri-store-line"></i> Sản phẩm
                </a>
                <a href="/brands" class="mobile-nav-item <%= path === '/brands' ? 'active' : '' %>">
                    <i class="ri-award-line"></i> Thương hiệu
                </a>
                <a href="/about" class="mobile-nav-item <%= path === '/about' ? 'active' : '' %>">
                    <i class="ri-information-line"></i> Giới thiệu
                </a>
                <a href="/contact" class="mobile-nav-item <%= path === '/contact' ? 'active' : '' %>">
                    <i class="ri-contacts-line"></i> Liên hệ
                </a>
                <!-- Cart - hiển thị cho tất cả người dùng -->
                <a href="/cart" class="mobile-nav-item <%= path === '/cart' ? 'active' : '' %>">
                    <i class="ri-shopping-cart-line"></i> Giỏ hàng
                </a>
                <% if (isAuthenticated) { %>
                    <a href="/orders" class="mobile-nav-item <%= path === '/orders' ? 'active' : '' %>">
                        <i class="ri-box-line"></i> Đơn hàng
                    </a>
                    <% if (isAdmin===true) { %>
                        <a href="/admin/add-product" class="mobile-nav-item <%= path === '/admin/add-product' ? 'active' : '' %>">
                            <i class="ri-add-circle-line"></i> Thêm sản phẩm
                        </a>
                        <a href="/admin/products" class="mobile-nav-item <%= path === '/admin/products' ? 'active' : '' %>">
                            <i class="ri-list-check"></i> Quản lý sản phẩm
                        </a>
                        <a href="/admin/orders" class="mobile-nav-item <%= path === '/admin/orders' ? 'active' : '' %>">
                            <i class="ri-shopping-bag-line"></i> Quản lý đơn hàng
                        </a>
                    <% } %>
                <% } else { %>
                    <a href="/login" class="mobile-nav-item <%= path === '/login' ? 'active' : '' %>">
                        <i class="ri-login-box-line"></i> Đăng nhập
                    </a>
                <% } %>
            </div>
        </div>
    </div>
    </div>
</nav>

<script>
// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', function() {
            mobileMenu.classList.toggle('hidden');
        });
    }
});
</script>
<% } %>